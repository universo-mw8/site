!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(a,r){if(!a&&this.length>0){var i=e(this[0]);return i.data(e.mask.dataName)()}r=e.extend({placeholder:"_",completed:null},r);var c=e.mask.definitions,o=[],l=a.length,u=null,s=a.length;return e.each(a.split(""),function(e,t){"?"==t?(s--,l=e):c[t]?(o.push(new RegExp(c[t])),null==u&&(u=o.length-1)):o.push(null)}),this.trigger("unmask").each(function(){function i(e){for(var t=b.val(),n=-1,a=0,i=0;a<s;a++)if(o[a]){for(w[a]=r.placeholder;i++<t.length;){var c=t.charAt(i-1);if(o[a].test(c)){w[a]=c,n=a;break}}if(i>t.length)break}else w[a]==t.charAt(i)&&a!=l&&(i++,n=a);return!e&&n+1<l?(b.val(""),h(0,s)):(e||n+1>=l)&&(f(),e||b.val(b.val().substring(0,n+1))),l?a:u}function f(){return b.val(w.join("")).val()}function h(e,t){for(var n=e;n<t&&n<s;n++)o[n]&&(w[n]=r.placeholder)}function d(e){var t=e.which,n=b.caret();if(e.ctrlKey||e.altKey||e.metaKey||t<32)return!0;if(t){n.end-n.begin!=0&&(h(n.begin,n.end),g(n.begin,n.end-1));var a=k(n.begin-1);if(a<s){var i=String.fromCharCode(t);if(o[a].test(i)){v(a),w[a]=i,f();var c=k(a);b.caret(c),r.completed&&c>=s&&r.completed.call(b)}}return!1}}function m(e){var t=e.which;if(8==t||46==t||n&&127==t){var a=b.caret(),r=a.begin,c=a.end;return c-r==0&&(r=46!=t?p(r):c=k(r-1),c=46==t?k(c):c),h(r,c),g(r,c-1),!1}if(27==t)return b.val(y),b.caret(0,i()),!1}function v(e){for(var t=e,n=r.placeholder;t<s;t++)if(o[t]){var a=k(t),i=w[t];if(w[t]=n,!(a<s&&o[a].test(i)))break;n=i}}function g(e,t){if(!(e<0)){for(var n=e,a=k(t);n<s;n++)if(o[n]){if(!(a<s&&o[n].test(w[a])))break;w[n]=w[a],w[a]=r.placeholder,a=k(a)}f(),b.caret(Math.max(u,e))}}function p(e){for(;--e>=0&&!o[e];);return e}function k(e){for(;++e<=s&&!o[e];);return e}var b=e(this),w=e.map(a.split(""),function(e,t){if("?"!=e)return c[e]?r.placeholder:e}),y=b.val();b.data(e.mask.dataName,function(){return e.map(w,function(e,t){return o[t]&&e!=r.placeholder?e:null}).join("")}),b.attr("readonly")||b.one("unmask",function(){b.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){y=b.val();var t=i();f();var n=function(){t==a.length?b.caret(0,t):b.caret(t)};(e.browser.msie?n:function(){setTimeout(n,0)})()}).bind("blur.mask",function(){i(),b.val()!=y&&b.change()}).bind("keydown.mask",m).bind("keypress.mask",d).bind(t,function(){setTimeout(function(){b.caret(i(!0))},0)}),i()})}})}(jQuery);